---
# sway role defaults

# Username for sway configuration
sway_username: "{{ target_user | default(ansible_user) | default('adam') }}"

# Installation method: 'nix' for Ubuntu (latest version), 'native' for Arch
# On Arch Linux, Sway is installed directly from pacman (latest version available)
# On Ubuntu/Debian, Nix is used to get Sway 1.11+ (Ubuntu 24.04 only has 1.9)
sway_install_method: "{{ 'native' if ansible_os_family == 'Archlinux' else 'nix' }}"

# Nix packages to install (when sway_install_method is 'nix')
# These provide the core Sway experience with latest versions
sway_nix_packages:
  - sway
  - kanshi           # Dynamic display configuration (like autorandr for Wayland)
  - wl-gammarelay-rs # Color temperature control (DBus interface)
  - wlr-randr        # xrandr-like tool for wlroots compositors
  - wdisplays        # GUI for display configuration
  - nixGL            # OpenGL wrapper for Nix on non-NixOS

# APT packages to install (Sway ecosystem tools for Debian/Ubuntu)
# These work well from Ubuntu repos and complement the Nix-installed Sway
sway_apt_packages:
  - waybar           # Status bar
  - wofi             # Application launcher (rofi alternative)
  - mako-notifier    # Notification daemon
  - grim             # Screenshot utility
  - slurp            # Region selection for screenshots
  - swayidle         # Idle management daemon
  - swaylock         # Screen locker
  - wl-clipboard     # Clipboard utilities
  - swaybg           # Wallpaper utility
  - xdg-desktop-portal-wlr  # Screen sharing support
  - xdg-desktop-portal-gtk  # GTK portal backend (required for gsettings theme switching)
  - libnotify-bin    # notify-send command
  - brightnessctl    # Brightness control
  - playerctl        # Media player control
  - network-manager-gnome  # nm-applet
  - blueman          # Bluetooth manager
  - pasystray        # PulseAudio system tray
  - pavucontrol      # PulseAudio volume control
  - xwayland         # X11 compatibility layer
  - nethogs          # Network traffic monitor (for waybar)
  - pcmanfm          # Lightweight file manager with GTK theme support

# Arch Linux packages (native Sway from repos - includes latest version)
# On Arch, Sway and all ecosystem tools are available directly from pacman
# Note: wl-gammarelay-rs and wdisplays are AUR/testing-only, not included here
sway_pacman_packages:
  - sway             # Wayland compositor (latest version in Arch repos)
  - foot             # Fast terminal emulator (no need to build from source)
  - waybar           # Status bar
  - wofi             # Application launcher (rofi alternative)
  - mako             # Notification daemon (different package name than Ubuntu)
  - grim             # Screenshot utility
  - slurp            # Region selection for screenshots
  - swayidle         # Idle management daemon
  - swaylock         # Screen locker
  - wl-clipboard     # Clipboard utilities
  - swaybg           # Wallpaper utility
  - xdg-desktop-portal-wlr  # Screen sharing support
  - xdg-desktop-portal-gtk  # GTK portal backend
  - libnotify        # notify-send command (different package name)
  - brightnessctl    # Brightness control
  - playerctl        # Media player control
  - network-manager-applet  # nm-applet (different package name)
  - blueman          # Bluetooth manager
  - pasystray        # PulseAudio system tray
  - pavucontrol      # PulseAudio volume control
  - xorg-xwayland    # X11 compatibility layer (different package name)
  - nethogs          # Network traffic monitor (for waybar)
  - pcmanfm          # Lightweight file manager with GTK theme support
  - kanshi           # Dynamic display configuration
  - wlr-randr        # xrandr-like tool for wlroots compositors
  - unzip            # Required for extracting Nerd Fonts zip files
  - python-psutil    # Required for Ansible dconf module (GTK theme config)
  - dconf            # Required for GTK theme configuration via gsettings

# Nethogs sudoers configuration
# Allows the user to run nethogs without password for waybar network traffic display
sway_configure_nethogs_sudoers: true

# Iotop configuration for disk traffic monitoring
# Installs iotop-c and sets capabilities for non-root disk I/O monitoring
# Required for waybar disk-traffic module
sway_configure_iotop: true

# Usbmon configuration for USB traffic monitoring
# Configures usbmon kernel module and udev rules for USB bandwidth monitoring
# Required for waybar usb-traffic module
sway_configure_usbmon: true

# Foot terminal installation (from source for latest version)
sway_install_foot_from_source: true
sway_foot_version: "1.25.0"

# i3-config repository for Sway configuration
sway_config_repo: "https://gitlab.com/adamwam/i3-config.git"
sway_config_branch: "master"  # Branch containing Sway configuration
sway_config_dest: "/home/{{ sway_username }}/.config/i3-config"

# Create symlinks for Sway configuration
sway_create_config_symlinks: true

# Symlinks to create (source relative to i3-config, dest relative to ~/.config)
sway_config_symlinks:
  - src: sway
    dest: sway
  - src: waybar
    dest: waybar
  - src: mako
    dest: mako
  - src: foot
    dest: foot
  - src: fusuma-sway
    dest: fusuma

# Optional components
sway_install_fusuma: true  # Touchpad gestures

# Fusuma dependencies (Debian/Ubuntu)
sway_fusuma_packages_debian:
  - ruby
  - ruby-dev
  - libevdev-dev
  - build-essential

# Fusuma dependencies (Arch Linux)
sway_fusuma_packages_arch:
  - ruby
  - libevdev
  - base-devel

# Session configuration
sway_create_desktop_entry: true

# Enable Wayland in GDM display manager
# GDM has WaylandEnable=false by default on some systems, which prevents
# Wayland sessions (including Sway) from appearing in the session list.
# This setting ensures WaylandEnable=true is set in /etc/gdm3/custom.conf
sway_enable_wayland_in_gdm: true

# Environment variables for Sway session
sway_environment_vars:
  XDG_CURRENT_DESKTOP: "sway:wlroots"
  XDG_SESSION_TYPE: "wayland"
  MOZ_ENABLE_WAYLAND: "1"
  QT_QPA_PLATFORM: "wayland"
  QT_WAYLAND_DISABLE_WINDOWDECORATION: "1"
  _JAVA_AWT_WM_NONREPARENTING: "1"
  SDL_VIDEODRIVER: "wayland"
  CLUTTER_BACKEND: "wayland"

# XKB keyboard configuration
# These settings configure the keyboard layout and custom modifier mappings
sway_xkb_layout: "pl"
sway_xkb_variant: "intl"

# Enable custom XKB keymap that maps Right Control to Mod3
# This replicates the local system's /usr/share/X11/xkb/symbols/pc modification
sway_deploy_custom_xkb_keymap: true

# XKB keymap file location (relative to i3-config repository)
sway_xkb_keymap_path: "xkb/keymap/custom"

# Fix swayidle monitor wake issue
# When multiple timeout statements are on the same swayidle command line,
# the resume functionality can fail intermittently (known bug in swayidle).
# This fix splits the swayidle configuration into separate processes.
# References:
# - https://github.com/swaywm/swayidle/issues/25
# - https://github.com/swaywm/sway/issues/5903
sway_fix_swayidle_monitor_wake: true

# Lock before sleep configuration
# This creates a systemd user service that locks the screen before system suspend
# This is more reliable than swayidle's before-sleep event which depends on logind D-Bus
sway_configure_lock_before_sleep: true

# Command to run for locking the screen before sleep
# Use -f (fork) so the service can complete and allow suspend to proceed
sway_lock_command: "/usr/bin/swaylock -f -c 000000"

# Wayland display to use for the lock command
# This is typically wayland-1 for the first Wayland session
sway_lock_wayland_display: "wayland-1"

# Slack Wayland compatibility
# Deploy desktop entry override to fix GPU/EGL issues on Sway
# See docs/slack-sway-compatibility-report.md for details
sway_configure_slack_wayland: true

# Slack binary and icon paths (for desktop entry override)
sway_slack_binary_path: "/usr/lib/slack/slack"
sway_slack_icon_path: "/usr/share/pixmaps/slack.png"

# GTK theme configuration for automatic dark/light mode switching
# This enables PCManFM and other GTK apps to follow the system theme
# The theme is controlled via gsettings (org.gnome.desktop.interface)
# and the set-dark-mode/set-light-mode scripts in the i3-config repository
sway_configure_gtk_theme: true

# Initial GTK theme settings (applied via dconf/gsettings)
# These are the default values; the set-dark-mode/set-light-mode scripts
# will update these at runtime for theme switching
sway_gtk_theme_name: "Adwaita"
sway_gtk_icon_theme_name: "Adwaita"
sway_gtk_cursor_theme_name: "Adwaita"
sway_gtk_font_name: "Sans 10"

# Color scheme preference: 'prefer-dark', 'prefer-light', or 'default'
# This controls GTK4 apps and is used by the theme switching scripts
sway_gtk_color_scheme: "prefer-dark"

# Bright CLI tool for extended brightness control
# Repository: https://github.com/adamryczkowski/bright
# Provides hardware backlight + software gamma correction for extended range
sway_install_bright: true

# Configure udev rules for backlight permissions
# Creates /etc/udev/rules.d/90-backlight.rules to allow video group access
sway_bright_configure_udev: true

# Add user to video group for backlight control
sway_bright_add_to_video_group: true

# Fix hardcoded paths in i3-config repository
# The i3-config repository contains hardcoded /home/adam/ paths that need to be
# replaced with the actual user's home directory for brightness controls to work
# This replaces /home/adam/ with /home/{{ sway_username }}/ in config files
sway_fix_hardcoded_paths: true

# greetd display manager configuration (Arch Linux only)
# greetd is a minimal, agnostic login manager daemon for Wayland compositors
# On Arch Linux, we use greetd instead of GDM for a lightweight login experience
# Reference: https://wiki.archlinux.org/title/Greetd
sway_install_greetd: "{{ ansible_os_family == 'Archlinux' }}"

# greetd packages to install
sway_greetd_packages:
  - greetd
  - greetd-tuigreet

# greetd configuration
# VT to run the greeter on (1 is the default console)
sway_greetd_vt: 1

# User to run the greeter as
sway_greetd_user: "greeter"

# Command to run for the greeter
# tuigreet options:
#   --time: Show current time
#   --remember: Remember last logged in user
#   --remember-session: Remember last session
#   --asterisks: Show asterisks for password input
#   --cmd: Default command to run (Sway)
sway_greetd_command: "tuigreet --time --remember --remember-session --asterisks --cmd sway"

# Fingerprint authentication configuration
# When enabled, the role will auto-detect supported fingerprint readers
# and configure fingerprint authentication for sudo and swaylock
# Reference: docs/fingerprint-sudo-swaylock.md
sway_enable_fingerprint_auth: true

# Supported fingerprint reader USB IDs (Synaptics ThinkPad readers)
# These are detected at runtime via lsusb
sway_fingerprint_usb_ids:
  - "06cb:00bd"  # Prometheus MIS Touch Fingerprint Reader
  - "06cb:009a"  # Metallica MIS Touch
  - "06cb:00c2"  # Synaptics Sensors

# swaylock-fprintd repository (for building from source)
# This fork of swaylock has native fingerprint support via D-Bus
sway_swaylock_fprintd_repo: "https://github.com/SL-RU/swaylock-fprintd.git"
sway_swaylock_fprintd_branch: "fprintd"
sway_swaylock_fprintd_dest: "/opt/swaylock-fprintd"

# Build dependencies for swaylock-fprintd (Debian/Ubuntu)
sway_fingerprint_build_packages_debian:
  - meson
  - ninja-build
  - libwayland-dev
  - wayland-protocols
  - libxkbcommon-dev
  - libcairo2-dev
  - libgdk-pixbuf-2.0-dev
  - libpam0g-dev
  - libdbus-1-dev
  - libglib2.0-dev
  - scdoc
  - git

# Build dependencies for swaylock-fprintd (Arch Linux - if AUR not available)
sway_fingerprint_build_packages_arch:
  - meson
  - ninja
  - wayland
  - wayland-protocols
  - libxkbcommon
  - cairo
  - gdk-pixbuf2
  - pam
  - dbus
  - glib2
  - scdoc
  - git

# Fingerprint packages (Debian/Ubuntu)
sway_fingerprint_packages_debian:
  - fprintd
  - libfprint-2-2
  - libfprint-2-tod1
  - libpam-fprintd
  - usbutils

# Fingerprint packages (Arch Linux)
sway_fingerprint_packages_arch:
  - fprintd
  - libfprint
  - usbutils

# AUR package for swaylock-fprintd (Arch Linux)
sway_swaylock_fprintd_aur_package: "swaylock-fprintd-git"
