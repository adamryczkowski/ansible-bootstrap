---
# Sway playbook - Install and configure Sway window manager
#
# This playbook installs Sway (Wayland compositor) using Nix for the latest
# version (1.11+) and configures it with the i3-config repository.
#
# Usage:
#   ansible-playbook -i inventory/virtualbox-test/hosts.yml playbooks/sway.yml
#
# The setup mirrors the local development environment with:
# - Sway 1.11 via Nix (with nixGL wrapper for OpenGL)
# - Foot terminal 1.25.0 compiled from source
# - Supporting tools (waybar, wofi, mako, etc.) via apt
# - Configuration from https://gitlab.com/adamwam/i3-config.git

- name: Install and configure Sway window manager
  hosts: all
  become: true
  gather_facts: true

  vars:
    target_user: "{{ ansible_user | default('adam') }}"

  pre_tasks:
    - name: Update apt cache
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 3600

    - name: Install essential packages
      ansible.builtin.apt:
        name:
          - git
          - curl
          - wget
          - build-essential
          - ca-certificates
          - gnupg
        state: present

  roles:
    - role: sway
      vars:
        sway_username: "{{ target_user }}"
        sway_install_method: nix
        sway_install_foot_from_source: true
        sway_install_fusuma: true
        sway_create_desktop_entry: true
      tags: [sway]

  post_tasks:
    - name: Display completion message
      ansible.builtin.debug:
        msg: |
          Sway installation complete for {{ target_user }}!

          To start Sway:
          1. Log out of your current session
          2. Select "Sway (Nix)" from the display manager session menu
          3. Or run 'sway-session' from a TTY

          Configuration is located at:
          - Sway config: ~/.config/sway/config
          - Waybar config: ~/.config/waybar/
          - Foot config: ~/.config/foot/foot.ini

          Note: You may need to log out and log back in for group changes to take effect.
